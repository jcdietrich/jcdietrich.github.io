<html>
    <head>
        <link rel="preload" as="font" crossOrigin="anonymous" href="linja-sike-beta-2-for-u.otf">
        <link rel="preload" as="font" crossOrigin="anonymous" href="linjasuwi.otf">
        <link rel="preload" as="font" crossOrigin="anonymous" href="PuLukin.otf">
        <link rel="preload" as="font" crossOrigin="anonymous" href="linja-pona-4.2.otf">
        <link rel="preload" as="font" crossOrigin="anonymous" href="sitelen-pona-pona.otf">
        <style>
            @font-face {font-family: linjasike; src: url(linja-sike-beta-2-for-u.otf)}
            @font-face {font-family: linjasuwi; src: url(linjasuwi.otf)}
            @font-face {font-family: pulukin; src: url(PuLukin.otf)}
            @font-face {font-family: linjapona; src: url(linja-pona-4.2.otf)}
            @font-face {font-family: sitelenponapona; src: url(sitelen-pona-pona.otf)}
            #text {font-size:200%; font-family: linjasike;width:100%;}
            #canvas {border-style: dashed;}
        </style>
        <script>
                   </script>
    </head>
    <body>
        <fieldset style="float:right;">
            <label>word lookup</label>
            <input type="text" id="word" autocorrect="off" autocapitalize="none"></input>
            <label><input type="checkbox" id="phrases" checked="checked"></input>include phrases</label>
            <button onclick="search(document.getElementById('word').value)">go</button>
            <ul id="definitions"/>
        </fieldset>
        <fieldset>
            <label>
                <select id="font" onchange="draw();">
                    <option value="linjasike" selected>linja sike</option>
                    <option value="linjasuwi">linja suwi</option>
                    <option value="pulukin">PuLukin</option>
                    <option value="linjapona">linja pona</option>
                    <option value="sitelenponapona">sitelen pona pona</option>
                </select>
                Font
            <label>
                </br>
                <input id="preview" type="checkbox" spellcheck="false" onclick="setPreview(this);" checked="true" />
                preview font 
            </label>
            </br>
            <label><input id="shadow" type="checkbox" onchange="draw()" />drop shadow</label>
            </br>
            <label><input id="glow" type="checkbox" onchange="draw()" />glow</label>
            </br>
            <label><input id="center" type="checkbox" onchange="draw()" />centered</label>
            </br>
            <label>
                <input id="fontsize" type="number" onBlur="draw()" value="56"></input>
                font size
            </label>
            </br>
            <label>
                <input id="strokesize" type="number" onBlur="draw()" value="1"></input>
                stroke size
            </label>
            </br>
            <fieldset>
                <legend>colours</legend>

                <select id="fontColour1">
                    <option value="Black" >Black</option>
                    <option value="White" >White</option>
                    <optgroup label="Red">
                        <option value="IndianRed">IndianRed</option>
                        <option value="LightCoral">LightCoral</option>
                        <option value="Salmon">Salmon</option>
                        <option value="DarkSalmon">DarkSalmon</option>
                        <option value="LightSalmon">LightSalmon</option>
                        <option value="Crimson">Crimson</option>
                        <option value="Red">Red</option>
                        <option value="FireBrick">FireBrick</option>
                        <option value="DarkRed">DarkRed</option>
                    </optgroup>
                    <optgroup label="Pink">
                        <option value="Pink">Pink</option>
                        <option value="LightPink">LightPink</option>
                        <option value="DarkPink">DarkPink</option>
                        <option value="HotPink">HotPink</option>
                        <option value="DeepPink">DeepPink</option>
                        <option value="MediumVioletRed">MediumVioletRed</option>
                        <option value="PaleVioletRed">PaleVioletRed</option>
                    </optgroup>
                    <optgroup label="Orange">
                        <option value="LightSalmon">LightSalmon</option>
                        <option value="Coral">Coral</option>
                        <option value="Tomato">Tomato</option>
                        <option value="OrangeRed">OrangeRed</option>
                        <option value="DarkOrange">DarkOrange</option>
                        <option value="Orange">Orange</option>
                    </optgroup>
                    <optgroup label="Yellow">
                        <option value="Gold">Gold</option>
                        <option value="Yellow">Yellow</option>
                        <option value="LightYellow">LightYellow</option>
                        <option value="LemonChiffon">LemonChiffon</option>
                        <option value="LightGoldenrodYellow">LightGoldenrodYellow</option>
                        <option value="PapayaWhip">PapayaWhip</option>
                        <option value="Moccasin">Moccasin</option>
                        <option value="PeachPuff">PeachPuff</option>
                        <option value="PaleGoldenrod">PaleGoldenrod</option>
                        <option value="Khaki">Khaki</option>
                        <option value="DarkKhaki">DarkKhaki</option>
                    </optgroup>
                    <optgroup label="Purple">
                        <option value="Lavender">Lavender</option>
                        <option value="Thistle">Thistle</option>
                        <option value="Plum">Plum</option>
                        <option value="Violet">Violet</option>
                        <option value="Orchid">Orchid</option>
                        <option value="Fuchsia">Fuchsia</option>
                        <option value="Magenta">Magenta</option>
                        <option value="MediumOrchid">MediumOrchid</option>
                        <option value="RebeccaPurple">RebeccaPurple</option>
                        <option value="BlueViolet">BlueViolet</option>
                        <option value="DarkOrchid">DarkOrchid</option>
                        <option value="DarkMagenta">DarkMagenta</option>
                        <option value="Purple">Purple</option>
                        <option value="Indigo">Indigo</option>
                        <option value="SlateBlue">SlateBlue</option>
                        <option value="MediumSlateBlue">MediumSlateBlue</option>
                        <option value="DarkSlateBlue">DarkSlateBlue</option>
                    </optgroup>
                    <optgroup label="Green">
                        <option value="GreenYellow">GreenYellow</option>
                        <option value="Chartreuse">Chartreuse</option>
                        <option value="LawnGreen">LawnGreen</option>
                        <option value="Lime">Lime</option>
                        <option value="LimeGreen">LimeGreen</option>
                        <option value="PaleGreen">PaleGreen</option>
                        <option value="LightGreen">LightGreen</option>
                        <option value="MediumSpringGreen">MediumSpringGreen</option>
                        <option value="SpringGreen">SpringGreen</option>
                        <option value="MediumSeaGreen">MediumSeaGreen</option>
                        <option value="SeaGreen">SeaGreen</option>
                        <option value="ForestGreen">ForestGreen</option>
                        <option value="Green">Green</option>
                        <option value="DarkGreen">DarkGreen</option>
                        <option value="YellowGreen">YellowGreen</option>
                        <option value="OliveDrab">OliveDrab</option>
                        <option value="Olive">Olive</option>
                        <option value="DarkOliveGreen">DarkOliveGreen</option>
                        <option value="MediumAquamarine">MediumAquamarine</option>
                        <option value="DarkSeaGreen">DarkSeaGreen</option>
                        <option value="LightSeaGreen">LightSeaGreen</option>
                        <option value="DarkCyan">DarkCyan</option>
                        <option value="Teal">Teal</option>
                    </optgroup>
                    <optgroup label="Blue">
                        <option value="Aqua">Aqua</option>
                        <option value="Cyan">Cyan</option>
                        <option value="LightCyan">LightCyan</option>
                        <option value="PaleTurquoise">PaleTurquoise</option>
                        <option value="Aquamarine">Aquamarine</option>
                        <option value="Turquoise">Turquoise</option>
                        <option value="MediumTurquoise">MediumTurquoise</option>
                        <option value="DarkTurquoise">DarkTurquoise</option>
                        <option value="CadetBlue">CadetBlue</option>
                        <option value="SteelBlue">SteelBlue</option>
                        <option value="LightSteelBlue">LightSteelBlue</option>
                        <option value="PowderBlue">PowderBlue</option>
                        <option value="LightBlue">LightBlue</option>
                        <option value="SkyBlue">SkyBlue</option>
                        <option value="LightSkyBlue">LightSkyBlue</option>
                        <option value="DeepSkyBlue">DeepSkyBlue</option>
                        <option value="DodgerBlue">DodgerBlue</option>
                        <option value="CornflowerBlue">CornflowerBlue</option>
                        <option value="MediumSlateBlue">MediumSlateBlue</option>
                        <option value="RoyalBlue">RoyalBlue</option>
                        <option value="Blue">Blue</option>
                        <option value="MediumBlue">MediumBlue</option>
                        <option value="DarkBlue">DarkBlue</option>
                        <option value="Navy">Navy</option>
                        <option value="MidnightBlue">MidnightBlue</option>
                    </optgroup>
                    <optgroup label="Brown">
                        <option value="Cornsilk">Cornsilk</option>
                        <option value="BlanchedAlmond">BlanchedAlmond</option>
                        <option value="Bisque">Bisque</option>
                        <option value="NavajoWhite">NavajoWhite</option>
                        <option value="Wheat">Wheat</option>
                        <option value="BurlyWood">BurlyWood</option>
                        <option value="Tan">Tan</option>
                        <option value="RosyBrown">RosyBrown</option>
                        <option value="SandyBrown">SandyBrown</option>
                        <option value="Goldenrod">Goldenrod</option>
                        <option value="DarkGoldenrod">DarkGoldenrod</option>
                        <option value="Peru">Peru</option>
                        <option value="Chocolate">Chocolate</option>
                        <option value="SaddleBrown">SaddleBrown</option>
                        <option value="Sienna">Sienna</option>
                        <option value="Brown">Brown</option>
                        <option value="Maroon">Maroon</option>
                    </optgroup>
                    <optgroup label="White">
                        <option value="White">White</option>
                        <option value="Snow">Snow</option>
                        <option value="HoneyDew">HoneyDew</option>
                        <option value="MintCream">MintCream</option>
                        <option value="Azure">Azure</option>
                        <option value="AliceBlue">AliceBlue</option>
                        <option value="GhostWhite">GhostWhite</option>
                        <option value="WhiteSmoke">WhiteSmoke</option>
                        <option value="SeaShell">SeaShell</option>
                        <option value="Beige">Beige</option>
                        <option value="OldLace">OldLace</option>
                        <option value="FloralWhite">FloralWhite</option>
                        <option value="Ivory">Ivory</option>
                        <option value="AntiqueWhite">AntiqueWhite</option>
                        <option value="Linen">Linen</option>
                        <option value="LavenderBlush">LavenderBlush</option>
                        <option value="MistyRose">MistyRose</option>
                    </optgroup>
                    <optgroup label="Gray">
                        <option value="Gainsboro">Gainsboro</option>
                        <option value="LightGray">LightGray</option>
                        <option value="Silver">Silver</option>
                        <option value="DarkGray">DarkGray</option>
                        <option value="Gray">Gray</option>
                        <option value="DimGray">DimGray</option>
                        <option value="LightSlateGray">LightSlateGray</option>
                        <option value="SlateGray">SlateGray</option>
                        <option value="DarkSlateGray">DarkSlateGray</option>
                        <option value="Black">Black</option>
                    </optgroup>
                </select>
                    <button id="fgc" onClick="addToFill()">add to fill gradient</button>
                    <button id="sgc" onClick="addToStroke()">add to stroke gradient</button>
                    <button id="sgc" onClick="addToBack()">add to background gradient</button>
                    </br>
                    </br>
                    <div>
                        <label>H<input type="radio" id="hfg" name="fg" onclick="draw()" checked value="h"></label>
                        <label>V<input type="radio" id="vfg" name="fg"onclick="draw()" value="v"></label>
                        <label>R<input type="radio" id="rfg" name="fg"onclick="draw()" value="r"></label>
                        Fill Colors:<span id="fillColours"></span>
                        <button id="fgc" onClick="resetFill()">reset fill gradient</button>
                    </div>
                    <div>
                        <label>H<input type="radio" id="hsg" onclick="draw()" name="sg" checked value="h"></label>
                        <label>V<input type="radio" id="vsg" name="sg" onclick="draw()" value="v"></label>
                        <label>R<input type="radio" id="rsg" name="sg" onclick="draw()" value="r"></label>
                        Stroke Colors:<span id="strokeColours"></span>
                        <button id="sgc" onClick="resetStroke()">reset stroke gradient</button>
                    </div>
                    <div>
                        <label>H<input type="radio" id="hbg" onclick="draw()" name="bg" checked value="h"></label>
                        <label>V<input type="radio" id="vbg" name="bg" onclick="draw()" value="v"></label>
                        <label>R<input type="radio" id="rbg" name="bg" onclick="draw()" value="r"></label>
                        Background Colors:<span id="backColours"></span>
                        <button id="sgc" onClick="resetBack()">reset background gradient</button>
                    </div>
            </fieldset>
            </br>
        <textarea id="text" spellcheck="false" autocorrect="off" autocapitalize="none" rows=5></textarea>
        <button id="go" onclick="draw()">go</button>
        <canvas id="canvas"></canvas>
        <img id='image'/>
        <p>
        <ul>
            <li><a href="linja-sike-beta-2-for-u.otf">linja sike</a> created by: lipamanka#6684 (on discord)</li>
            <li><a href="linjasuwi.otf">linja suwi</a> created by: <a href="https://linjasuwi.ap5.dev/">jan Ana</a></li>
            <li><a href="linja-pona-4.2.otf">linja pona</a> created by: <a href="http://musilili.net/linja-pona/">David A. Roberts</a></li>
            <li><a href="sitelen-pona-pona.otf">sitelen pona pona</a> created by: <a href="https://jackhumbert.github.io/sitelen-pona-pona/">Jack Humbert</a></li>
            <li><a href="PuLukin.otf">PuLukin</a> created by: <a href="https://zacstan.github.io/OKepekenELinjaPiPuLukin/">jan Sa</a></li>
        </ul>
        </p>
        <script>
            const text = document.getElementById('text');
            const canvas = document.getElementById('canvas');
           
            let strokeColours = [];
            let fillColours = [];
            let backColours = [];

            text.value = decodeURI(window.location.hash.substr(1));

            const setPreview = preview => {
                if (preview.checked){
                    text.style.fontFamily = document.getElementById("font").value;
                } else {
                    text.style.fontFamily = 'arial';
                }
            };

            const draw = () => {
                setPreview(document.getElementById('preview'));
                window.location.hash = encodeURI(text.value);
                const fontsize = document.getElementById('fontsize').value;
                const stroke = document.getElementById('strokesize').value;
                const lines = text.value.split('\n')
                ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.font = `${fontsize}px ${document.getElementById("font").value}`;
                const metrics = ctx.measureText('[');
                canvas.width = lines.reduce((len, line) => {
                    ctx.fillText(line, 0, fontsize);
                    const info = ctx.measureText(line);

                    const lineWidth = info.width + Math.floor(fontsize);
                    if (lineWidth > len){
                       return lineWidth;
                    };

                    return len;
                }, 0);

                canvas.height = metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent + 20 + parseInt(stroke) + (lines.length -1) * fontsize;

                const centerX = canvas.width /2;
                const centerY = canvas.height/2;
                
                const numBack = backColours.length;
                let gradient2;

                if(document.getElementById('hbg').checked) {
                    gradient2 = ctx.createLinearGradient(0, 0, canvas.width, 0);
                } else if (document.getElementById('vbg').checked) {
                    gradient2 = ctx.createLinearGradient(0, 0, 0, canvas.height);
                } else {
                    gradient2 = ctx.createRadialGradient(centerX, centerY, 10, centerX, centerY, canvas.width/2);
                }

                if (numBack === 1){
                    ctx.fillStyle = backColours[0];
                } else if(numBack >= 2) {
                    gradient2.addColorStop("0", backColours[0]);
                    gradient2.addColorStop("1.0", backColours[numBack-1]);

                    numInner = numBack - 2;
                    if (numInner >0){
                        const gradIncr = 1/ (numInner +1);
                        let currentIncr = gradIncr;
                        for (let i = 0; i <= numInner; i++){
                            gradient2.addColorStop(currentIncr, backColours[i+1]);
                            currentIncr += gradIncr;
                        }
                    }
                    ctx.fillStyle = gradient2;
                };

                if (numBack > 0){
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                };
                
                ctx.font = `${fontsize}px ${document.getElementById("font").value}`;
                var lineOffset = 0;

                for (line of lines) {
                    const yOffset = fontsize - metrics.fontBoundingBoxDescent + Math.floor(stroke/2) - lineOffset + 9;
                    let xOffset = Math.floor(fontsize/2);
                    
                    if (document.getElementById('center').checked){
                        const lineWidth = ctx.measureText(line).width;
                        xOffset = (canvas.width - lineWidth) / 2;
                    };

                    if (document.getElementById('shadow').checked) {
                        ctx.shadowOffsetX = 3;
                        ctx.shadowOffsetY = 3;
                        ctx.shadowColor = "rgba(0,0,0,0.3)";
                        ctx.shadowBlur = 4;
                    };

                    const numStroke = strokeColours.length;
                    let gradient1;

                    if (document.getElementById('hsg').checked) {
                        gradient1 = ctx.createLinearGradient(0, 0, canvas.width, 0);
                    } else if (document.getElementById('vsg').checked) {
                        gradient1 = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    } else {
                        gradient1 = ctx.createRadialGradient(centerX, centerY, 10, centerX, centerY, canvas.width/2);
                    }

                    if (numStroke === 1){
                        ctx.strokeStyle = strokeColours[0];
                    } else if(numStroke >= 2) {
                        gradient1.addColorStop("0", strokeColours[0]);
                        gradient1.addColorStop("1.0", strokeColours[numStroke-1]);
                        
                        numInner = numStroke - 2;
                        if (numInner >0){
                           const gradIncr = 1/ (numInner +1);
                            let currentIncr = gradIncr;
                            for (let i = 0; i <= numInner; i++){
                                gradient1.addColorStop(currentIncr, strokeColours[i+1]);
                                currentIncr += gradIncr;
                            }
                        }
                        ctx.strokeStyle = gradient1;
                    };

                    if (numStroke > 0){
                        ctx.lineWidth = stroke;
                        ctx.strokeText(line, xOffset, yOffset);
                    };


                    const glow = document.getElementById('glow').checked;
                    if (glow) {
                        ctx.lineWidth = stroke;
                        ctx.filter = `blur(${Math.min(stroke,8)}px)`;
                        ctx.strokeText(line, xOffset, yOffset);
                        ctx.filter = "none";
                    };

                    const numFill = fillColours.length;
                    let gradient;

                    if (document.getElementById('hfg').checked) {
                        gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
                    } else if (document.getElementById('vfg').checked) {
                        gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    } else {
                        gradient = ctx.createRadialGradient(centerX, centerY, 10, centerX, centerY, canvas.width/2);
                    }

                    if (numFill === 1){
                        ctx.fillStyle = fillColours[0];
                    } else if(numFill >= 2) {
                        gradient.addColorStop("0", fillColours[0]);
                        gradient.addColorStop("1.0", fillColours[numFill - 1]);
                        
                        numInner = numFill - 2;
                        if (numInner > 0){
                            const gradIncr = 1/ (numInner +1);
                            let currentIncr = gradIncr;
                            for (let i = 0; i <= numInner; i++){
                                gradient.addColorStop(currentIncr, fillColours[i+1]);
                                currentIncr += gradIncr;
                            }
                        }
                        ctx.fillStyle = gradient;
                    };

                    if (fontColour1 !== 'none') {
                        ctx.fillText(line, xOffset, yOffset);
                    };

                    lineOffset = parseInt(lineOffset) - parseInt(fontsize) -  Math.floor(stroke/2) ;
                };

                const image = document.getElementById('image');
                image.src = canvas.toDataURL();
            }
            window.onload = draw;

            var dictionary;
            fetch("toki-pona-lessons_en.json")
                .then(res => res.json())
                .then(data => dictionary = data);

            search = (query) => {
                const oldListings = document.getElementById('definitions');
                const listings = oldListings.cloneNode(false);
                oldListings.parentNode.replaceChild(listings, oldListings);
                const phrases = document.getElementById('phrases').checked;
                if (query !== ""){
                    for (word of dictionary.words) {
                        if(word.entry.form.toLowerCase().split(" ").includes(query.toLowerCase())
                            || word.translations[0].forms[0].toLowerCase().replace(/[,()!?']/g,'').split(" ").includes(query.toLowerCase())){
                            if(!(word.translations[0].title === "phrase" && !phrases)){
                                const li = document.createElement("li");
                                const text = document.createTextNode(
`${word.entry.form}: (${word.translations[0].title}) ${word.translations[0].forms[0]}`);
                                li.appendChild(text);
                                listings.appendChild(li);
                            }
                        }
                    }
                }
            }

            const wordbox = document.getElementById("word");
            wordbox.addEventListener("keydown", ({key}) => {
                if (key === "Enter"){
                    search(document.getElementById("word").value);
                }
            });

            const addToStroke = () => {
               strokeColours.push(document.getElementById('fontColour1').value);
                document.getElementById('strokeColours').innerHTML = strokeColours;
                draw();
            }

            const addToFill = () => {
               fillColours.push(document.getElementById('fontColour1').value);
                document.getElementById('fillColours').innerHTML = fillColours;
                draw();
            }

            const addToBack = () => {
               backColours.push(document.getElementById('fontColour1').value);
                document.getElementById('backColours').innerHTML = backColours;
                draw();
            }

            const resetFill = () => {
               fillColours = [];
                document.getElementById('fillColours').innerHTML = fillColours;
                draw();
            }

            const resetStroke = () => {
                strokeColours = [];
                document.getElementById('strokeColours').innerHTML = strokeColours;
                draw();
            }

            const resetBack = () => {
                backColours = [];
                document.getElementById('backColours').innerHTML = backColours;
                draw();
            }
        </script>
    </body>
</html>
