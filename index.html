<html>
    <head>
        <style>
            @font-face {font-family: linjasike; src: url(linja-sike-beta-2-for-u.otf)}
            #text {font-size:400%; font-family: linjasike;}
            #canvas {border-style: dashed;}
        </style>
    </head>
    <body>
        <fieldset>
            <label>
                <input id="preview" type="checkbox" spellcheck="false" onclick="setPreview(this);" checked="true" />
                preview toki pona
            </label>
            </br>
            <label><input id="shadow" type="checkbox" />drop shadow</label>
            </br>
            <label><input id="glow" type="checkbox" />glow</label>
            </br>
            </br>
            <fieldset>
                <legend>font colours</legend>

                <select id="fontColour1">
                    <option value="black" >black</option>
                    <option value="none">none</option>
                    <option value="red">red</option>
                    <option value="blue">blue</option>
                    <option value="green">green</option>
                    <option value="purple">purple</option>
                    <option value="yellow">yellow</option>
                    <option value="orange">orange</option>
                    <option value="white">white</option>
                </select>
                
                <select id="fontColour2">
                    <option value="none">none</option>
                    <option value="black" >black</option>
                    <option value="red">red</option>
                    <option value="blue">blue</option>
                    <option value="green">green</option>
                    <option value="purple">purple</option>
                    <option value="yellow">yellow</option>
                    <option value="orange">orange</option>
                    <option value="white">white</option>
                </select>

                <select id="fontColour3">
                    <option value="none">none</option>
                    <option value="black" >black</option>
                    <option value="red">red</option>
                    <option value="blue">blue</option>
                    <option value="green">green</option>
                    <option value="purple">purple</option>
                    <option value="yellow">yellow</option>
                    <option value="orange">orange</option>
                    <option value="white">white</option>
                </select>
                <label>
            </fieldset>
            <fieldset>
                <legend>stroke colours</legend>

                <select id="strokeColour1">
                    <option value="none">none</option>
                    <option value="black" >black</option>
                    <option value="red">red</option>
                    <option value="blue">blue</option>
                    <option value="green">green</option>
                    <option value="purple">purple</option>
                    <option value="yellow">yellow</option>
                    <option value="orange">orange</option>
                    <option value="white">white</option>
                </select>
                
                <select id="strokeColour2">
                    <option value="none">none</option>
                    <option value="black" >black</option>
                    <option value="red">red</option>
                    <option value="blue">blue</option>
                    <option value="green">green</option>
                    <option value="purple">purple</option>
                    <option value="yellow">yellow</option>
                    <option value="orange">orange</option>
                    <option value="white">white</option>
                </select>

                <select id="strokeColour3">
                    <option value="none">none</option>
                    <option value="black" >black</option>
                    <option value="red">red</option>
                    <option value="blue">blue</option>
                    <option value="green">green</option>
                    <option value="purple">purple</option>
                    <option value="yellow">yellow</option>
                    <option value="orange">orange</option>
                    <option value="white">white</option>
                </select>
                <label>
            </fieldset>
            <label>
                <input id="fontsize" type="number" value="56"></input>
                font size
            </label>
        </fieldset>
        <textarea id="text" spellcheck="false"></textarea>
        <button id="go" onclick="draw()">go</button>
        <canvas id="canvas"></canvas>
        <img id='image'/>
        <p>
        <a href="linja-sike-beta-2-for-u.otf">font</a> created by: lipamanka#6684 (on discord)
        </p>
        <script>
            const text = document.getElementById('text');
            const canvas = document.getElementById('canvas');
            
            text.value = decodeURI(window.location.hash.substr(1));

            const setPreview = preview => {
                if (preview.checked){
                    text.style.fontFamily = 'linjasike';
                } else {
                    text.style.fontFamily = 'arial';
                }
            };

            const draw = () => {
                window.location.hash = encodeURI(text.value);
                const fontsize = document.getElementById('fontsize').value;
                const yOffset = fontsize;
                ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.font = `${fontsize}px linjasike`;
                ctx.fillText(text.value, 0, yOffset);
                metrics = ctx.measureText(text.value);
                canvas.width = metrics.width + Math.floor(metrics.width/4); 
                console.log(metrics);
                canvas.height = metrics.fontBoundingBoxAscent + metrics.fontBoundingBoxDescent + 10;
                ctx.font = `${fontsize}px linjasike`;

                if (document.getElementById('shadow').checked) {
                    ctx.shadowOffsetX = 3;
                    ctx.shadowOffsetY = 3;
                    ctx.shadowColor = "rgba(0,0,0,0.3)";
                    ctx.shadowBlur = 4;
                };

                const strokeColour = document.getElementById('strokeColour');


                const strokeColour1 = document.getElementById('strokeColour1').value;
                const strokeColour2 = document.getElementById('strokeColour2').value;
                const strokeColour3 = document.getElementById('strokeColour3').value;
                const gradient1 = ctx.createLinearGradient(0, 0, canvas.width, 0);

                if (strokeColour2 !== 'none') {
                    if (strokeColour3 != 'none') {
                        gradient1.addColorStop("0", strokeColour1);
                        gradient1.addColorStop("0.5", strokeColour2);
                        gradient1.addColorStop("1.0", strokeColour3);
                    } else {
                        gradient1.addColorStop("0", strokeColour1);
                        gradient1.addColorStop("1.0", strokeColour2);
                    };
                    ctx.strokeStyle = gradient1;
                } else {
                    ctx.strokeStyle = strokeColour1;
                }
                
                if (strokeColour1 !== 'none'){
                    ctx.lineWidth = 1;
                    ctx.strokeText(text.value, Math.floor(metrics.width/8), yOffset - metrics.fontBoundingBoxDescent + 5);
                };

                const fontColour1 = document.getElementById('fontColour1').value;
                const fontColour2 = document.getElementById('fontColour2').value;
                const fontColour3 = document.getElementById('fontColour3').value;
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, 0);

                if (fontColour2 !== 'none') {
                    if (fontColour3 != 'none') {
                        gradient.addColorStop("0", fontColour1);
                        gradient.addColorStop("0.5", fontColour2);
                        gradient.addColorStop("1.0", fontColour3);
                    } else {
                        gradient.addColorStop("0", fontColour1);
                        gradient.addColorStop("1.0", fontColour2);
                    };
                    ctx.fillStyle = gradient;
                } else {
                    ctx.fillStyle = fontColour1;
                };
                
                const glow = document.getElementById('glow').checked;
                if (glow) {
                    ctx.lineWidth = 3;
                    ctx.strokeText(text.value, Math.floor(metrics.width/8), yOffset - metrics.fontBoundingBoxDescent + 5);
                    ctx.filter = "blur(5px)";
                    ctx.filter = "none";
                };
                
                if (fontColour1 !== 'none') {
                    ctx.fillText(text.value, Math.floor(metrics.width/8), yOffset - metrics.fontBoundingBoxDescent + 5);
                };

                const image = document.getElementById('image');
                image.src = canvas.toDataURL();
            }
            window.onload = draw;
        </script>
    </body>
</html>
